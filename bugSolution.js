The solution involved restructuring the data to use a flatter structure or incorporating a serialization/deserialization step using a library like `lodash` to handle the nested objects. The `onSnapshot` callback is modified to handle both online and offline data loading correctly and handle deserialization. By ensuring data is properly converted before storage and retrieval, the offline persistence behavior improved significantly. For extremely complex nested structures, consider using a dedicated schema definition language and a conversion library for better maintainability.